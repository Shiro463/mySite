<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>クイズアプリ（スマホ最適化フルスクリーン版）</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    scroll-behavior: smooth;
  }

  /* ---------------- LocalStorage UI ---------------- */
  .localstorage-block {
    border: 1px solid #aaa;
    padding: 10px;
  }

  .localstorage-block .button-group {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }

  .localstorage-block button {
    padding: 8px 12px;
    font-size: 16px;
    border-radius: 5px;
    border: none;
    background: #333;
    color: #fff;
    cursor: pointer;
  }

  #storageInfo {
    display: none;
    margin-top: 10px;
    white-space: pre-wrap;
    max-height: 200px;
    overflow-y: auto;
    background: #f0f0f0;
    padding: 5px;
    border-radius: 5px;
  }

  /* ---------------- クイズブロック ---------------- */
  .quiz-block {
    display: flex;
    flex-direction: column;
    padding: 10px;
    gap: 10px;
  }

  .quiz-container {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .title {
    color: #6cb4e4;
    text-align: center;
    padding: 0.5em;
    border-top: 2px solid #6cb4e4;
    border-bottom: 2px solid #6cb4e4;
    background: repeating-linear-gradient(-45deg, #f0f8ff, #f0f8ff 3px, #e9f4ff 3px, #e9f4ff 7px);
    font-size: 22px;
  }

  /* ---------------- 問題フルスクリーン風 ---------------- */
  .question-area, .answer-area {
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 15px;
    font-size: 20px;
    min-height: 300px;
    line-height: 1.5;
    background: #fafafa;
    overflow-y: auto;
  }

  select {
    font-size: 18px;
    padding: 6px 8px;
  }

  .button-group {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }

  .myButtonBlue, .myButtonGreen, .myButtonRed {
    font-size: 20px;
    padding: 0.5em 1em;
    border-radius: 5px;
    border: 2px solid;
    cursor: pointer;
    transition: 0.3s;
  }

  .myButtonBlue { color: #67c5ff; border-color: #67c5ff; }
  .myButtonBlue:hover { background: #67c5ff; color: white; }
  .myButtonGreen { color: #76ff67; border-color: #76ff67; }
  .myButtonGreen:hover { background: #76ff67; color: white; }
  .myButtonRed { color: #ff6767; border-color: #ff6767; }
  .myButtonRed:hover { background: #ff6767; color: white; }

  /* ---------------- ステータステーブル ---------------- */
  .status-table-container {
    max-height: 250px;
    overflow-y: auto;
    border: 1px solid #aaa;
    border-radius: 8px;
  }

  .status-table {
    border-collapse: collapse;
    width: 100%;
    font-size: 14px;
  }

  .status-table td {
    padding: 8px;
    border: 1px solid #000;
    text-align: center;
    position: relative;
    min-width: 70px;
  }

  .status-table .wrong-count { position: absolute; right: 4px; top: 2px; font-size: 12px; color: red; }
  .correct-count { position: absolute; left: 4px; top: 2px; font-size: 12px; color: green; }
  .weight-display { position: absolute; left: 4px; bottom: 0; font-size: 12px; color: gray; }

  .blue { background-color: #add8e6; }
  .green { background-color: #90ee90; }
  .red { background-color: #f08080; }

  /* ---------------- フローティングボタン ---------------- */
  .floating-buttons {
    position: fixed;
    bottom: 10px;
    right: 10px;
    display: flex;
    flex-direction: column;
    gap: 5px;
    z-index: 9999;
    background: rgba(255,255,255,0.9);
    padding: 6px;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
  }

  .floating-buttons button {
    padding: 6px 10px;
    font-size: 12px;
    border: none;
    border-radius: 6px;
    background: #333;
    color: #fff;
    cursor: pointer;
  }

  .floating-buttons button:hover { background: #555; }

  /* ---------------- レスポンシブ ---------------- */
  @media (max-width: 768px) {
    .question-area, .answer-area { font-size: 18px; min-height: 250px; }
    select { font-size: 16px; padding: 4px 6px; }
    .myButtonBlue, .myButtonGreen, .myButtonRed { font-size: 18px; padding: 0.4em 0.8em; }
    .floating-buttons { right: 50%; transform: translateX(50%); flex-direction: row; gap: 8px; }
    .status-table td { font-size: 12px; min-width: 60px; padding: 6px; }
  }
</style>
</head>
<body>

<!-- LocalStorage表示ブロック -->
<div class="localstorage-block">
  <div class="button-group">
    <button id="toggleStorageBtn" type="button">LocalStorage表示/非表示</button>
    <button id="clearStorageBtn" type="button">LocalStorageリセット</button>
  </div>
  <pre id="storageInfo"></pre>
</div>

<!-- クイズブロック -->
<div class="quiz-block" id="quizBlock-0">
  <div class="quiz-container">
    <p class="title">イタリア語</p>
    <label>出題範囲:
      <select id="startSelect-0"></select> 〜
      <select id="endSelect-0"></select>
    </label>
    <label>並び順:
      <select id="sortSelect-0"></select>
    </label>
    <label>除外する正解数:
      <select id="excludeCorrectSelect-0"></select>
      <button class="myButtonBlue" id="resetCountsBtn-0">リセット</button>
    </label>
    <button class="myButtonBlue" id="nextBtn-0">出題</button>
    <div class="question-area" id="questionArea-0">ここに問題文が表示されます</div>
    <button class="myButtonBlue" id="showAnswerBtn-0">答えを見る</button>
    <div class="answer-area" id="answerArea-0" style="color: gray;">ここに答えが表示されます</div>
    <div class="button-group">
      <button class="myButtonGreen" id="correctBtn-0">正解</button>
      <button class="myButtonRed" id="wrongBtn-0">不正解</button>
    </div>
  </div>

  <div class="status-table-container">
    <table class="status-table" id="statusTable-0"></table>
  </div>
</div>


<!-- フローティングボタン -->
<!-- <div class="floating-buttons">
  <button data-target="quizBlock-0">イタリア語</button>
</div> -->

<script>
const quizData0 = [ /*イタリア語 40001～*/
  { id: 40001, label: "fiore",
  question:
  "fiore (m.)",
  answer:
  "花" },

  { id: 40002, label: "porta",
  question:
  "porta",
  answer:
  "門" },

  { id: 40003, label: "chiave",
  question:
  "chiave (f.)",
  answer:
  "鍵" },

  { id: 40004, label: "tavolo",
  question:
  "tavolo",
  answer:
  "机" },

  { id: 40005, label: "cravatta",
  question:
  "cravatta",
  answer:
  "ネクタイ" },



// ===========================================
//           =======
//           =======
//           =======
//           =======
//           =======
//           =======
//           =======
//           =======
//           =======
//           =======
//           =======
//           =======
//           =======
//      =================
//       ===============
//        =============
//         ===========
//          =========
//           =======
//            =====
//             ===
//              =
// ===========================================





  { id: 45001, label: "croissant",
  question:
  "クロワッサンcroissant",
  answer:
  "cornetto" },





];

// クイズブロック作成
const titles = ["イタリア語"]; // 任意の科目名リスト
const template = document.querySelector('.quiz-block'); // 最初のブロックをテンプレートに
const container = document.createElement('div'); // 全体を包む要素（任意）

titles.forEach((title, index) => {
  const newBlock = template.cloneNode(true);
  newBlock.id = `quizBlock-${index}`;

  // タイトル書き換え
  newBlock.querySelector('p.title').textContent = title;

  // ID付き要素のIDをすべて更新
  const elementsWithId = newBlock.querySelectorAll('[id]');
  elementsWithId.forEach(el => {
    const oldId = el.id;
    const newId = oldId.replace(/-\d+$/, `-${index}`);
    el.id = newId;
  });

  container.appendChild(newBlock);
});

// 元のテンプレートは削除しておく（重複を防ぐ）
template.remove();
document.body.appendChild(container); // あるいは適切な場所へ追加



// クイズ作成
function createQuiz(blockId, data) {
    const questionArea = document.getElementById(`questionArea-${blockId}`);
    const answerArea = document.getElementById(`answerArea-${blockId}`);
    const nextBtn = document.getElementById(`nextBtn-${blockId}`);
    const showAnswerBtn = document.getElementById(`showAnswerBtn-${blockId}`);
    const correctBtn = document.getElementById(`correctBtn-${blockId}`);
    const wrongBtn = document.getElementById(`wrongBtn-${blockId}`);
    const statusTable = document.getElementById(`statusTable-${blockId}`);
    const startSelect = document.getElementById(`startSelect-${blockId}`);
    const endSelect = document.getElementById(`endSelect-${blockId}`);
    const excludeCorrectSelect = document.getElementById(`excludeCorrectSelect-${blockId}`);
    const sortSelect = document.getElementById(`sortSelect-${blockId}`);
    const resetCountsBtn = document.getElementById(`resetCountsBtn-${blockId}`);


    let currentId = null;
    let remaining = [];
    let previousHighlightedId = null; // 前回青くしたセルのIDを保存
    let lastBlueId = null; // 直前に青にしたセル



    const statusMap = new Map();
    const wrongCounts = new Map();
    const correctCounts = new Map();

    // 状態初期化
    function init() {
        startSelect.innerHTML = '';
        endSelect.innerHTML = '';
        excludeCorrectSelect.innerHTML = '';
        lastBlueId = null;

        data.forEach(d => {
            const opt1 = document.createElement("option");
            opt1.value = d.id;
            opt1.textContent = d.id;
            const opt2 = opt1.cloneNode(true);
            startSelect.appendChild(opt1);
            endSelect.appendChild(opt2);
        });
        startSelect.value = data[0].id;
        endSelect.value = data[data.length - 1].id;

        for (let i = 1; i <= 5; i++) {
            const opt = document.createElement("option");
            opt.value = i;
            opt.textContent = i;
            excludeCorrectSelect.appendChild(opt);
        }
        excludeCorrectSelect.value = 5;


        for (const [value, label] of [
        ['label-asc', 'label昇順'],
        ['label-desc', 'label降順'],
        ['id-asc', 'id昇順'],
        ['id-desc', 'id降順']
        ]) {
            const opt = document.createElement("option");
            opt.value = value;
            opt.textContent = label;
            sortSelect.appendChild(opt);
        }
        sortSelect.value = 'label-asc';

        startSelect.value = localStorage.getItem(`startSelect-${blockId}`) ?? data[0].id;
        endSelect.value = localStorage.getItem(`endSelect-${blockId}`) ?? data[data.length - 1].id;
        excludeCorrectSelect.value = localStorage.getItem(`excludeCorrectSelect-${blockId}`) ?? 5;
        sortSelect.value = localStorage.getItem(`sortSelect-${blockId}`) ?? 'label-asc';


        buildTable();
        loadWrongCounts();
        loadCorrectCounts();
        resetState();
        loadCellColors(); // ← 最後に追加
    }
  
    // テーブル作成
    function buildTable() {
        statusTable.innerHTML = '';
        statusMap.clear();
        const sortedData = getSortedData();
        const rowHeight = 500 / data.length + 'px';

        sortedData.forEach(d => {
            const row = statusTable.insertRow();
            const cell = row.insertCell();
            cell.textContent = d.label;
            row.style.height = rowHeight;
            cell.style.position = "relative";

            const wrongCount = wrongCounts.get(d.id) ?? 0;
            const correctCount = correctCounts.get(d.id) ?? 0;

            // weight計算 (不正解+1)/(正解+1)
            const weight = ((wrongCount + 1) / (correctCount + 1)).toFixed(2);

            // weight表示
            const weightSpan = document.createElement("span");
            weightSpan.className = "weight-display";
            weightSpan.textContent = weight;
            cell.appendChild(weightSpan);

            const wrongSpan = document.createElement("span");
            wrongSpan.className = "wrong-count";
            wrongSpan.textContent = `×${wrongCount}`;
            cell.appendChild(wrongSpan);

            const correctSpan = document.createElement("span");
            correctSpan.className = "correct-count";
            correctSpan.textContent = `○${correctCount}`;
            cell.appendChild(correctSpan);

            statusMap.set(d.id, { cell, wrongSpan, correctSpan, weightSpan });
        });

        loadCellColors();
    }



    // 問題文・答えリセット
    function resetState() {
        remaining = [];
        currentId = null;
        lastBlueId = null;
        questionArea.textContent = "ここに問題文が表示されます";
        answerArea.textContent = "ここに答えが表示されます";
        data.forEach(d => {
            const entry = statusMap.get(d.id);
            entry.cell.className = '';
        });
        setButtonsEnabled(false);
        buildTable();
    }


    // 正解・不正解数をリセットボタンを押したとき
    resetCountsBtn.addEventListener('click', () => {
        if (!confirm('正解・不正解数をリセットしますか？')) return;

        // カウント初期化
        wrongCounts.clear();
        correctCounts.clear();

        // localStorageから削除
        localStorage.removeItem(`wrongCounts-${blockId}`);
        localStorage.removeItem(`correctCounts-${blockId}`);
        localStorage.removeItem(`cellColors-${blockId}`); // ← この1行を追加


        // テーブル再描画
        buildTable();
    });

    // ボタンを使えないようにする
    function setButtonsEnabled(enabled) {
        showAnswerBtn.disabled = !enabled;
        correctBtn.disabled = !enabled;
        wrongBtn.disabled = !enabled;
    }


    // 出題範囲の取得
    function getRangeData() {
        const start = parseInt(startSelect.value);
        const end = parseInt(endSelect.value);
        const excludeThreshold = parseInt(excludeCorrectSelect.value);
        return data.filter(d =>
            d.id >= start &&
            d.id <= end &&
            (correctCounts.get(d.id) ?? 0) < excludeThreshold
        );
    }
    // 並び順の取得
    function getSortedData() {
        const sortType = sortSelect.value;
        const sorted = [...data];
        switch (sortType) {
            case 'label-asc':
            sorted.sort((a, b) => a.label.localeCompare(b.label));
            break;
            case 'label-desc':
            sorted.sort((a, b) => b.label.localeCompare(a.label));
            break;
            case 'id-asc':
            sorted.sort((a, b) => a.id - b.id);
            break;
            case 'id-desc':
            sorted.sort((a, b) => b.id - a.id);
            break;
        }
        return sorted;
    }
 

    // 出題
    function pickQuestion() {
        if (remaining.length === 0) {
            questionArea.textContent = "おわり！";
            answerArea.textContent = "";
            setButtonsEnabled(false);
            return;
        }

        const now = new Date();
        const weights = remaining.map(item => {
            const wrong = wrongCounts.get(item.id) ?? 0;
            const correct = correctCounts.get(item.id) ?? 0;

            let days = 0;
            if (item.lastReview) {
                days = Math.floor((now - new Date(item.lastReview)) / (1000 * 60 * 60 * 24));
            }

            return ((wrong + 1) / (correct + 1)) * (1 + days * 0.1);
        });

        const totalWeight = weights.reduce((a, b) => a + b, 0);
        let r = Math.random() * totalWeight;
        let index = 0;
        for (let i = 0; i < weights.length; i++) {
            r -= weights[i];
            if (r <= 0) {
                index = i;
                break;
            }
        }

        const item = remaining.splice(index, 1)[0];
        currentId = item.id;
        item.lastReview = now; // 出題時に更新

        let styledQuestion = item.question
          .replace(/(\(|（)(.*?)(\)|）)/g, '<span style="color: orange;">$1$2$3</span>')
          .replace(/【(.*?)】|{(.*?)}/g, (match, p1, p2) => {
            if (p1 !== undefined) return `<span style="color: red; font-weight: bold;">【${p1}】</span>`;
            if (p2 !== undefined) {
              let inner = p2.replace(/【(.*?)】/g, '<span style="color: red; font-weight: bold;">【$1】</span>');
              return `<span style="color: blue; font-weight: bold; text-decoration: underline;">{${inner}}</span>`;
            }
            return match;
          });

        questionArea.innerHTML = styledQuestion;
        answerArea.innerHTML = `<span style="color: gray;">ここに答えが表示されます</span>`;
        highlightCell(item.id, 'blue');
        setButtonsEnabled(true);

        if (window.MathJax) MathJax.typesetPromise([questionArea]);
    }


    // セル色を付ける
    // function highlightCell(id, className) {
    //     const entry = statusMap.get(id);
    //     entry.cell.className = '';
    //     if (className) {
    //             entry.cell.classList.add(className);
    //             saveCellColor(id, className); // ← 追加
    //     } else {
    //             removeCellColor(id); // ← 追加：色を消したときにも反映
    //     }
    // }
    // function highlightCell(id, className) {
    //     // 前回青だったセルを元の色に戻す
    //     if (previousHighlightedId !== null && previousHighlightedId !== id) {
    //         restoreCellClass(previousHighlightedId); // 復元処理
    //     }

    //     const entry = statusMap.get(id);
    //     entry.cell.className = '';
    //     if (className) {
    //         entry.cell.classList.add(className);
    //         if (className !== 'blue') {
    //             saveCellColor(id, className);
    //         }
    //     } else {
    //         removeCellColor(id);
    //     }

    //     // 今回青くしたセルを記録
    //     if (className === 'blue') {
    //         previousHighlightedId = id;
    //     } else {
    //         previousHighlightedId = null;
    //     }
    // }
    function highlightCell(id, className) {
      // 新しい青を付ける直前に、前回の青セルを元の色に戻す
      if (className === 'blue' && lastBlueId !== null && lastBlueId !== id) {
        restoreCellClass(lastBlueId);
      }

      const entry = statusMap.get(id);
      if (!entry) return;

      // いったん全消ししてから指定色を適用
      entry.cell.className = '';
      if (className) {
        entry.cell.classList.add(className);

        if (className !== 'blue') {
          // green/red は保存（blue は保存しない）
          saveCellColor(id, className);
          lastBlueId = null; // 青の選択状態は解除
        } else {
          // blue は保存しないが、直前の青として記録
          lastBlueId = id;
        }
      } else {
        // 色を外すリクエスト
        removeCellColor(id);
        if (lastBlueId === id) lastBlueId = null;
      }
    }


    // function restoreCellClass(id) {
    //     const entry = statusMap.get(id);
    //     if (!entry) return;

    //     // localStorageに保存されているクラスを復元
    //     const savedClass = loadCellColor(id);
    //     entry.cell.className = '';

    //     if (savedClass) {
    //         entry.cell.classList.add(savedClass);
    //     }
    // }
    function restoreCellClass(id) {
      const entry = statusMap.get(id);
      if (!entry) return;

      entry.cell.className = '';
      const savedClass = getSavedCellColor(id); // ← 1件取得に変更
      if (savedClass) {
        entry.cell.classList.add(savedClass);
      }
    }

    // セル色を保存
    function saveCellColor(id, className) {
        if (className !== "blue"){
            const key = `cellColors-${blockId}`;
            const saved = localStorage.getItem(key);
            const colors = saved ? JSON.parse(saved) : {};
            colors[id] = className;
            localStorage.setItem(key, JSON.stringify(colors));
        }
    }
    // セル色を削除
    function removeCellColor(id) {
        const key = `cellColors-${blockId}`;
        const saved = localStorage.getItem(key);
        if (saved) {
            const colors = JSON.parse(saved);
            delete colors[id];
            localStorage.setItem(key, JSON.stringify(colors));
        }
    }
    // セル色をロード
    function loadCellColors() {
        const key = `cellColors-${blockId}`;
        const saved = localStorage.getItem(key);
        if (saved) {
            const colors = JSON.parse(saved);
            for (const [idStr, className] of Object.entries(colors)) {
            const id = parseInt(idStr);
            const entry = statusMap.get(id);
            if (entry) {
                entry.cell.classList.add(className);
            }
            }
        }
    }

    function getSavedCellColor(id) {
      const key = `cellColors-${blockId}`;
      const saved = localStorage.getItem(key);
      if (!saved) return null;
      const colors = JSON.parse(saved);
      return colors[id] ?? null;
    }


    // 間違い数を保存
    function saveWrongCounts() {
        const obj = {};
        for (const [id, count] of wrongCounts.entries()) {
            obj[id] = count;
        }
        localStorage.setItem(`wrongCounts-${blockId}`, JSON.stringify(obj));
    }
    // 間違い数をロード
    function loadWrongCounts() {
        const saved = localStorage.getItem(`wrongCounts-${blockId}`);
        if (saved) {
            const obj = JSON.parse(saved);
            for (const [idStr, count] of Object.entries(obj)) {
                const id = parseInt(idStr);
                wrongCounts.set(id, count);

                // カウントを表示
                const entry = statusMap.get(id);
                if (entry && entry.wrongSpan) {
                    entry.wrongSpan.textContent = `×${count}`;
                }
            }
        }
    }
  
    // 正解数を保存
    function saveCorrectCounts() {
        const obj = {};
        for (const [id, count] of correctCounts.entries()) {
            obj[id] = count;
        }
        localStorage.setItem(`correctCounts-${blockId}`, JSON.stringify(obj));
    }
    // 正解数をロード
    function loadCorrectCounts() {
        const saved = localStorage.getItem(`correctCounts-${blockId}`);
        if (saved) {
            const obj = JSON.parse(saved);
            for (const [idStr, count] of Object.entries(obj)) {
                const id = parseInt(idStr);
                correctCounts.set(id, count);

                // カウントを表示
                const entry = statusMap.get(id);
                if (entry && entry.correctSpan) {
                    entry.correctSpan.textContent = `○${count}`;
                }
            }
        }
    }

    // 出題範囲の値が変わったら保存
    startSelect.addEventListener('change', () => {
        localStorage.setItem(`startSelect-${blockId}`, startSelect.value);
    });
    endSelect.addEventListener('change', () => {
        localStorage.setItem(`endSelect-${blockId}`, endSelect.value);
    });
    // 正解数による出題範囲が変わったら保存
    excludeCorrectSelect.addEventListener('change', () => {
        localStorage.setItem(`excludeCorrectSelect-${blockId}`, excludeCorrectSelect.value);
    });


    // 正解数による出題範囲が変わったら保存
    sortSelect.addEventListener('change', () => {
        localStorage.setItem(`sortSelect-${blockId}`, sortSelect.value);
        buildTable();
    });
    // 出題ボタンを押したとき
    nextBtn.addEventListener('click', () => {
        const rangeData = getRangeData();
        // 出題する問題が無くなったらおわり！
        if (remaining.length === 0 && questionArea.textContent === "おわり！") {
            resetState();
        }
        remaining = rangeData.slice();
        pickQuestion();
    });

    function colorizeParentheses(text) {
      const colors = [
        "#FFA500", // 濃いオレンジ
        "#FFB733", // 少し薄い
        "#FFCC80", // さらに薄い
        "#FFE0B3"  // もっと薄い（必要なら増やす）
      ];

      let result = "";
      let depth = 0;

      for (let char of text) {
        if (char === "(" || char === "（") {
          const color = colors[Math.min(depth, colors.length - 1)];
          result += `<span style="color: ${color};">` + char;
          depth++;
        } else if (char === ")" || char === "）") {
          depth = Math.max(0, depth - 1);
          result += char + "</span>";
        } else {
          result += char;
        }
      }

      return result;
    }

    // 答えを見るボタンを押したとき
    showAnswerBtn.addEventListener('click', () => {
        if (currentId !== null) {
            const item = data.find(d => d.id === currentId);
            // answerArea.innerHTML = `<span style="color: black;">${item.answer}</span>`;

          let styledAnswer = colorizeParentheses(item.answer)
            // 【】と{}の処理を適用
            .replace(/【(.*?)】|{(.*?)}/g, (match, p1, p2) => {
              if (p1 !== undefined) {
                return `<span style="color: red; font-weight: bold;">【${p1}】</span>`;
              }
              if (p2 !== undefined) {
                let inner = p2.replace(/【(.*?)】/g, '<span style="color: red; font-weight: bold;">【$1】</span>');
                return `<span style="color: blue; font-weight: bold; text-decoration: underline;">{${inner}}</span>`;
              }
              return match;
            });

          // 全体黒で囲む
          answerArea.innerHTML = `<span style="color: black;">${styledAnswer}</span>`;
        }
        
        // MathJaxで数式を再描画
        if (window.MathJax) {
            MathJax.typesetPromise([answerArea]);
        }
    });
    // 正解したボタンを押したとき
    correctBtn.addEventListener('click', () => {
        if (currentId !== null) {
            const entry = statusMap.get(currentId);
            const newCount = (correctCounts.get(currentId) ?? 0) + 1;
            correctCounts.set(currentId, newCount);

            if (entry && entry.correctSpan) {
            entry.correctSpan.textContent = `○${newCount}`;
            }

            highlightCell(currentId, 'green');
            saveCorrectCounts();
            pickQuestion();
        }
    });
    // 不正解だったボタンを押したとき
    wrongBtn.addEventListener('click', () => {
        if (currentId !== null) {
            const entry = statusMap.get(currentId);
            const newCount = (wrongCounts.get(currentId) ?? 0) + 1;
            wrongCounts.set(currentId, newCount);

            if (entry && entry.wrongSpan) {
            entry.wrongSpan.textContent = `×${newCount}`;
            }

            highlightCell(currentId, 'red');
            saveWrongCounts();
            pickQuestion();
        }
    });

    init();
}

createQuiz(0, quizData0);
// createQuiz(1, quizData2);
// createQuiz(2, quizData3);
// createQuiz(3, quizData4);

// ---------------- LocalStorage表示トグル ----------------
const toggleBtn = document.getElementById('toggleStorageBtn');
const storageInfo = document.getElementById('storageInfo');
toggleBtn.addEventListener('click', () => {
  if (storageInfo.style.display === 'none' || storageInfo.style.display === '') {
    let output = '';
    for (let i = 0; i < localStorage.length; i++) {
      const key = localStorage.key(i);
      const value = localStorage.getItem(key);
      output += `${key} = ${value}\n`;
    }
    storageInfo.textContent = output;
    storageInfo.style.display = 'block';
  } else {
    storageInfo.style.display = 'none';
  }
});

// LocalStorageリセット
document.getElementById('clearStorageBtn').addEventListener('click', () => {
  if (confirm('LocalStorageをすべて消しますか？')) {
    localStorage.clear();
    storageInfo.textContent = '';
  }
});

document.querySelectorAll('.floating-buttons button').forEach(button => {
  button.addEventListener('click', () => {
    const targetId = button.getAttribute('data-target');
    const targetElement = document.getElementById(targetId);
    if (targetElement) {
      targetElement.scrollIntoView({ behavior: 'smooth' });
    }
  });
});

</script>
</body>
</html>

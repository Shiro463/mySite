<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>クイズアプリ（スマホ最適化版）</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
    scroll-behavior: smooth;
  }

  /* ---------------- LocalStorage UI ---------------- */
  .localstorage-block {
    border: 1px solid #aaa;
    padding: 10px;
  }

  .localstorage-block .button-group {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }

  .localstorage-block button {
    padding: 8px 12px;
    font-size: 10px;
    border-radius: 5px;
    border: none;
    background: #333;
    color: #fff;
    cursor: pointer;
  }

  #storageInfo {
    display: none;
    margin-top: 10px;
    white-space: pre-wrap;
    max-height: 200px;
    overflow-y: auto;
    background: #f0f0f0;
    padding: 5px;
    border-radius: 5px;
  }

  /* ---------------- クイズブロック ---------------- */
  .quiz-block {
    display: flex;
    flex-direction: column;
    padding: 10px;
    gap: 10px;
  }

  .quiz-container {
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .title {
    color: #6cb4e4;
    text-align: center;
    padding: 0.5em;
    border-top: 2px solid #6cb4e4;
    border-bottom: 2px solid #6cb4e4;
    background: repeating-linear-gradient(-45deg, #f0f8ff, #f0f8ff 3px, #e9f4ff 3px, #e9f4ff 7px);
    font-size: 22px;
  }

  /* ---------------- 問題・答えエリア ---------------- */
  .question-area, .answer-area {
    border: 1px solid #ccc;
    border-radius: 8px;
    padding: 12px;
    font-size: 18px;
    min-height: 40px; /* 少し小さめに調整 */
    line-height: 1.5;
    background: #fafafa;
    overflow-y: auto;
  }

  select {
    font-size: 16px;
    padding: 5px 6px;
  }

  .button-group {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: flex-end; /* 右寄せ */
  }

  .myButtonBlue, .myButtonGreen, .myButtonRed {
    font-size: 18px;
    padding: 0.4em 0.8em;
    border-radius: 5px;
    border: 2px solid;
    cursor: pointer;
    transition: 0.3s;
  }

  .myButtonBlue { color: #67c5ff; border-color: #67c5ff; }
  .myButtonBlue:hover { background: #67c5ff; color: white; }
  .myButtonGreen { color: #76ff67; border-color: #76ff67; }
  .myButtonGreen:hover { background: #76ff67; color: white; }
  .myButtonRed { color: #ff6767; border-color: #ff6767; }
  .myButtonRed:hover { background: #ff6767; color: white; }

  /* ---------------- ステータステーブル ---------------- */
  .status-table-container {
    max-height: 200px;
    overflow-y: auto;
    border: 1px solid #aaa;
    border-radius: 8px;
  }

  .status-table {
    border-collapse: collapse;
    width: 100%;
    font-size: 14px;
  }

  .status-table td {
    padding: 6px;
    border: 1px solid #000;
    text-align: center;
    position: relative;
    min-width: 60px;
  }

  .status-table .wrong-count { position: absolute; right: 4px; top: 2px; font-size: 12px; color: red; }
  .correct-count { position: absolute; left: 4px; top: 2px; font-size: 12px; color: green; }
  .weight-display { position: absolute; left: 15%; top: 2px; font-size: 12px; color: gray; }

  .blue { background-color: #add8e6; }
  .green { background-color: #90ee90; }
  .red { background-color: #f08080; }

  /* ---------------- フローティングボタン ---------------- */
  .floating-buttons {
    position: fixed;
    bottom: 10px;
    right: 10px;
    display: flex;
    flex-direction: column;
    gap: 5px;
    z-index: 9999;
    background: rgba(255,255,255,0.9);
    padding: 6px;
    border-radius: 8px;
    box-shadow: 0 0 10px rgba(0,0,0,0.2);
  }

  .floating-buttons button {
    padding: 6px 10px;
    font-size: 12px;
    border: none;
    border-radius: 6px;
    background: #333;
    color: #fff;
    cursor: pointer;
  }

  .floating-buttons button:hover { background: #555; }

  /* ---------------- レスポンシブ ---------------- */
  @media (max-width: 768px) {
    .question-area, .answer-area { font-size: 16px; min-height: 40px; padding: 6px;  }
    select { font-size: 14px; padding: 4px 5px; }
    .myButtonBlue, .myButtonGreen, .myButtonRed { font-size: 16px; padding: 0.35em 0.7em; }
    .floating-buttons { right: 50%; transform: translateX(50%); flex-direction: row; gap: 8px; }
    .status-table td { font-size: 12px; min-width: 50px; padding: 5px; }
  }
</style>
</head>
<body>


<!-- クイズブロック -->
<div class="quiz-block" id="quizBlock-0">
  <div class="quiz-container">
    <p class="title">イタリア語</p>
    <label>出題範囲:
      <select id="startSelect-0"></select> 〜
      <select id="endSelect-0"></select>
    </label>
    <label>並び順:
      <select id="sortSelect-0"></select>
    </label>
    <label>除外する正解数:
      <select id="excludeCorrectSelect-0"></select>
      <button class="myButtonBlue" id="resetCountsBtn-0">リセット</button>
    </label>
    <button class="myButtonBlue" id="nextBtn-0">出題</button>
    <div class="question-area" id="questionArea-0">ここに問題文が表示されます</div>
    <button class="myButtonBlue" id="showAnswerBtn-0">答えを見る</button>
    <div class="answer-area" id="answerArea-0" style="color: gray;">ここに答えが表示されます</div>
    <div class="button-group">
      <button class="myButtonGreen" id="correctBtn-0">正解</button>
      <button class="myButtonRed" id="wrongBtn-0">不正解</button>
    </div>
    <!-- ステータステーブル表示/非表示ボタン -->
    <div class="button-group">
      <button id="toggleTableBtn">テーブル表示/非表示</button>
      <button id="toggleIdSortBtn">ID順</button>
      <button id="toggleWeightSortBtn">Weight順</button>
    </div>



  </div>

  <div class="status-table-container" id="statusTableContainer">
    <table class="status-table" id="statusTable-0"></table>
  </div>
  <!-- LocalStorage表示ブロック -->
  <div class="localstorage-block">
    <div class="button-group">
      <button id="toggleStorageBtn" type="button">LocalStorage表示/非表示</button>
      <button id="clearStorageBtn" type="button">LocalStorageリセット</button>
    </div>
    <pre id="storageInfo"></pre>
  </div>
</div>



<!-- フローティングボタン -->
<!-- <div class="floating-buttons">
  <button data-target="quizBlock-0">イタリア語</button>
</div> -->

<script>
const quizData0 = [ /*イタリア語 40001～*/
  { id: 40001, label: "fiore",
  question:
  "fiore (m.)",
  answer:
  "花" },

  { id: 40002, label: "porta",
  question:
  "porta",
  answer:
  "門" },

  { id: 40003, label: "chiave",
  question:
  "chiave (f.)",
  answer:
  "鍵" },

  { id: 40004, label: "tavolo",
  question:
  "tavolo",
  answer:
  "机" },

  { id: 40005, label: "cravatta",
  question:
  "cravatta",
  answer:
  "ネクタイ" },

  { id: 40006, label: "telefono",
  question:
  "telefono",
  answer:
  "電話" },

  { id: 40007, label: "dolce",
  question:
  "dolce (m.)",
  answer:
  "菓子" },

  { id: 40008, label: "borsa",
  question:
  "borsa",
  answer:
  "かばん" },

  { id: 40009, label: "canzone",
  question:
  "canzone",
  answer:
  "歌" },

  { id: 40010, label: "gatto",
  question:
  "gatto",
  answer:
  "猫" },

  { id: 40011, label: "penna",
  question:
  "penna",
  answer:
  "ペン" },

  { id: 40012, label: "melone",
  question:
  "melone (m.)",
  answer:
  "メロン" },

  { id: 40013, label: "volpe",
  question:
  "volpe (f.)",
  answer:
  "キツネ" },

  { id: 40014, label: "albergo",
  question:
  "albergo",
  answer:
  "ホテル" },

  { id: 40015, label: "1軒のホテル",
  question:
  "1軒のホテル",
  answer:
  "un albergo" },

  { id: 40016, label: "ombrello",
  question:
  "ombrello",
  answer:
  "傘" },

  { id: 40017, label: "1つの傘",
  question:
  "1つの傘",
  answer:
  "un ombrello" },

  { id: 40018, label: "studente",
  question:
  "studente",
  answer:
  "男子学生" },

  { id: 40019, label: "1人の男子学生",
  question:
  "1人の男子学生",
  answer:
  "uno studente" },

  { id: 40020, label: "scherzo",
  question:
  "scherzo",
  answer:
  "冗談" },

  { id: 40021, label: "1つの冗談",
  question:
  "1つの冗談",
  answer:
  "uno scherzo" },

  { id: 40022, label: "zaino",
  question:
  "zaino",
  answer:
  "リュック" },

  { id: 40023, label: "1つのリュック",
  question:
  "1つのリュック",
  answer:
  "uno zaino" },

  { id: 40024, label: "stella",
  question:
  "stella",
  answer:
  "星" },

  { id: 40025, label: "nave",
  question:
  "nave (f.)",
  answer:
  "船" },

  { id: 40026, label: "1隻の船",
  question:
  "1隻の船",
  answer:
  "una nave" },

  { id: 40027, label: "1個の鍵",
  question:
  "1個の鍵",
  answer:
  "una chiave" },

  { id: 40028, label: "aula",
  question:
  "aula",
  answer:
  "教室" },

  { id: 40029, label: "1つの教室",
  question:
  "1つの教室",
  answer:
  "un'aula" },

  { id: 40030, label: "isola",
  question:
  "isola",
  answer:
  "島" },

  { id: 40031, label: "1つの島",
  question:
  "1つの島",
  answer:
  "un'isola" },

  { id: 40032, label: "agenda",
  question:
  "agenda",
  answer:
  "手帳" },

  { id: 40033, label: "1つの手帳",
  question:
  "1つの手帳",
  answer:
  "un'agenda" },

  { id: 40034, label: "camera",
  question:
  "camera \n 不定冠詞単数形は？ \n 複数形は？",
  answer:
  "部屋 \n una camera \n camere" },

  { id: 40035, label: "erba",
  question:
  "erba \n 不定冠詞単数形は？ \n 複数形は？",
  answer:
  "草 \n un'erba \n erbe" },

  { id: 40036, label: "ora",
  question:
  "ora \n 不定冠詞単数形は？ \n 複数形は？",
  answer:
  "時間 \n un'ora \n ore" },

  { id: 40037, label: "scaffale",
  question:
  "scaffale(m.) \n 不定冠詞単数形は？ \n 複数形は？",
  answer:
  "棚 \n uno scaffale \n scaffali" },

  { id: 40038, label: "arte",
  question:
  "arte(f.) \n 不定冠詞単数形は？ \n 複数形は？",
  answer:
  "芸術 \n un'arte \n arti" },

  { id: 40039, label: "quaderno",
  question:
  "quaderno \n 不定冠詞単数形は？ \n 複数形は？",
  answer:
  "ノート \n un quaderno \n quaderni" },
  
  { id: 40040, label: "macchina",
  question:
  "macchina \n 不定冠詞単数形は？ \n 複数形は？",
  answer:
  "自動車 \n una macchina \n macchine" },
  
  { id: 40041, label: "anello",
  question:
  "anello \n 不定冠詞単数形は？ \n 複数形は？",
  answer:
  "指輪 \n un anello \n anelli" },
  
  { id: 40042, label: "limone",
  question:
  "limone(m.) \n 不定冠詞単数形は？ \n 複数形は？",
  answer:
  "レモン \n un limone \n limoni" },
  
  { id: 40043, label: "stazione",
  question:
  "stazione(f.) \n 不定冠詞単数形は？ \n 複数形は？",
  answer:
  "駅 \n una stazione \n stazioni" },
  
  { id: 40044, label: "stivale",
  question:
  "stivale(m.) \n 不定冠詞単数形は？ \n 複数形は？",
  answer:
  "ブーツ \n uno stivale \n stivali" },
  
  { id: 40045, label: "albero",
  question:
  "albero \n 定冠詞単数形は？ \n 定冠詞複数形は？",
  answer:
  "本 \n l'albero \n gli alberi" },
  
  { id: 40046, label: "matita",
  question:
  "matita \n 定冠詞単数形は？ \n 定冠詞複数形は？",
  answer:
  "鉛筆 \n la matita \n le matite" },
  
  { id: 40047, label: "piazza",
  question:
  "piazza \n 定冠詞単数形は？ \n 定冠詞複数形は？",
  answer:
  "広場 \n la piazza \n le piazze" },
  
  { id: 40048, label: "gonna",
  question:
  "gonna \n 定冠詞単数形は？ \n 定冠詞複数形は？",
  answer:
  "スカート \n la gonna \n le gonne" },
  
  { id: 40049, label: "spettacolo",
  question:
  "spettacolo \n 定冠詞単数形は？ \n 定冠詞複数形は？",
  answer:
  "ショー \n lo spettacolo \n gli spettacoli" },
  
  { id: 40050, label: "giornale",
  question:
  "giornale(m.) \n 定冠詞単数形は？ \n 定冠詞複数形は？",
  answer:
  "新聞 \n il giornare \n i giornali" },
  
  { id: 40051, label: "errore",
  question:
  "errore(m.) \n 定冠詞単数形は？ \n 定冠詞複数形は？",
  answer:
  "誤り \n l'errore \n gli errori" },
  
  { id: 40052, label: "cane",
  question:
  "cane(m.) \n 定冠詞単数形は？ \n 定冠詞複数形は？",
  answer:
  "犬 \n il cane \n i cani" },
  
  { id: 40053, label: "unghia",
  question:
  "unghia \n 定冠詞単数形は？ \n 定冠詞複数形は？",
  answer:
  "爪 \n l'unghia \n le unghie" },
  
  { id: 40054, label: "sciarpa",
  question:
  "sciarpa \n 定冠詞単数形は？ \n 定冠詞複数形は？",
  answer:
  "マフラー \n la sciarpa \n le sciarpe" },
  
  { id: 40055, label: "strumento",
  question:
  "strumento \n 定冠詞単数形は？ \n 定冠詞複数形は？",
  answer:
  "道具 \n lo strumento \n gli strumenti" },
  
  { id: 40056, label: "un divano comodo",
  question:
  "un divano comodo",
  answer:
  "快適なソファー" },
  
  { id: 40057, label: "快適なソファー",
  question:
  "快適なソファー(不定冠詞複数形)",
  answer:
  "divani comodi" },
  
  { id: 40058, label: "una casa comoda",
  question:
  "una casa comoda",
  answer:
  "快適な家" },
  
  { id: 40059, label: "快適な家",
  question:
  "快適な家(不定冠詞複数形)",
  answer:
  "case comode" },
  
  { id: 40060, label: "un libro pesante",
  question:
  "un libro pesante",
  answer:
  "重い本" },
  
  { id: 40061, label: "重い本",
  question:
  "重い本(不定冠詞複数形)",
  answer:
  "libri pesanti" },
  
  { id: 40062, label: "una borsa pesante",
  question:
  "una borsa pesante",
  answer:
  "重い鞄" },
  
  { id: 40063, label: "重い鞄",
  question:
  "重い鞄(不定冠詞複数形)",
  answer:
  "borse pesanti" },
  
  { id: 40064, label: "un giornale giapponese",
  question:
  "un giornale giapponese",
  answer:
  "日本の新聞" },
  
  { id: 40065, label: "日本の新聞",
  question:
  "日本の新聞(不定冠詞複数形)",
  answer:
  "giornali giapponesi" },
  
  { id: 40066, label: "una macchina giapponese",
  question:
  "una macchina giapponese",
  answer:
  "日本車" },
  
  { id: 40067, label: "日本車",
  question:
  "日本車(不定冠詞複数形)",
  answer:
  "macchine giapponesi" },

  { id: 40068, label: "caro",
  question:
  "caro",
  answer:
  "親愛なる" },

  { id: 40069, label: "cattivo",
  question:
  "cattivo",
  answer:
  "悪い" },

  { id: 40070, label: "giovane",
  question:
  "giovane",
  answer:
  "若い" },

  { id: 40071, label: "vero",
  question:
  "vero",
  answer:
  "本当の" },

  { id: 40072, label: "alto",
  question:
  "palazzo alto \n alta società",
  answer:
  "高いビル \n 上流社会" },

  { id: 40073, label: "cetra",
  question:
  "notizia certa \n certa notizia",
  answer:
  "確かなニュース \n ある知らせ" },

  { id: 40074, label: "cane",
  question:
  "cane grande \n grande uomo",
  answer:
  "大きな犬 \n 偉大な人" },

  { id: 40075, label: "povero",
  question:
  "studente povero \n povero anziano",
  answer:
  "貧乏な学生 \n 哀れな老人" },

  { id: 40076, label: "studentessa italiana",
  question:
  "studentessa italianaの意味？ \n 不定冠詞を付けると？ \n 複数形は？",
  answer:
  "イタリア人の女学生 \n una studentessa italiana \n studentesse italiane" },

  { id: 40077, label: "libro leggero",
  question:
  "libro leggeroの意味？ \n 不定冠詞を付けると？ \n 複数形は？",
  answer:
  "軽い本 \n un libro leggero \n libli leggeri" },

  { id: 40078, label: "ombrello verde",
  question:
  "ombrello verdeの意味？ \n 不定冠詞を付けると？ \n 複数形は？",
  answer:
  "緑色の傘 \n un ombrello verde \n ombrelli verdi" },

  { id: 40079, label: "unghia rossa",
  question:
  "unghia rossaの意味？ \n 不定冠詞を付けると？ \n 複数形は？",
  answer:
  "赤い爪 \n un'unghia rossa \n unghie rosse" },

  { id: 40080, label: "spettacolo interessante",
  question:
  "spettacolo interessanteの意味？ \n 不定冠詞を付けると？ \n 複数形は？",
  answer:
  "おもしろいショー \n uno spettacolo interessante \n spettacoli interessanti" },

  { id: 40081, label: "cane pericoloso",
  question:
  "cane pericolosoの意味？ \n 不定冠詞を付けると？ \n 複数形は？",
  answer:
  "危険な犬 \n un cane pericoloso \n cani pericolosi" },

  { id: 40082, label: "sedia semplice",
  question:
  "sedia sempliceの意味？ \n 不定冠詞を付けると？ \n 複数形は？",
  answer:
  "シンプルな椅子 \n una sedia semplice \n sedie semplici" },

  { id: 40083, label: "zingaro povero",
  question:
  "zingaro poveroの意味？ \n 不定冠詞を付けると？ \n 複数形は？",
  answer:
  "貧しいジプシー \n uno zingaro povero \n zingari poveri" },

  { id: 40084, label: "treno veloce",
  question:
  "treno veloceの意味？ \n 不定冠詞を付けると？ \n 複数形は？",
  answer:
  "速い列車 \n un treno veloce \n treni veloci" },

  { id: 40085, label: "albero alto",
  question:
  "albero altoの意味？ \n 不定冠詞を付けると？ \n 複数形は？",
  answer:
  "背の高い木 \n un albero alto \n alberi alti" },

  { id: 40086, label: "opera elegante",
  question:
  "opera eleganteの意味？ \n 不定冠詞を付けると？ \n 複数形は？",
  answer:
  "上品な作品 \n un'opera elegante \n opere eleganti" },

  { id: 40087, label: "piccola camera",
  question:
  "piccola cameraの意味？ \n 不定冠詞を付けると？ \n 複数形は？",
  answer:
  "小さい部屋 \n una piccola camera \n piccole camere" },

  { id: 40088, label: "giovane medico",
  question:
  "giovane medicoの意味？ \n 不定冠詞を付けると？ \n 複数形は？",
  answer:
  "若い医者 \n un giovane medico \n giovani medici" },

  { id: 40089, label: "infermiera onesta",
  question:
  "infermiera onestaの意味？ \n 不定冠詞を付けると？ \n 複数形は？",
  answer:
  "誠実な女性看護師 \n un'infermiera onesta \n infermiere oneste" },

  { id: 40090, label: "scrittore popolare",
  question:
  "scrittore popolareの意味？ \n 不定冠詞を付けると？ \n 複数形は？",
  answer:
  "人気の男性作家 \n uno scrittore popolare \n scrittori popolari" },

  { id: 40091, label: "famiglia felice",
  question:
  "famiglia feliceの意味？ \n 不定冠詞を付けると？ \n 複数形は？",
  answer:
  "幸せな家族 \n una famiglia felice \n famiglie felici" },

  { id: 40092, label: "leone grande",
  question:
  "leone grandeの意味？ \n 不定冠詞を付けると？ \n 複数形は？",
  answer:
  "大きなライオン \n un leone grande \n leoni grandi" },

  { id: 40093, label: "Tu ( ) onesto.",
  question:
  "Tu ( ) onesto. \n essereの活用形",
  answer:
  "Tu sei onesto. \n 君は誠実です。" },

  { id: 40094, label: "Lui ( ) italiano.",
  question:
  "Lui ( ) italiano. \n essereの活用形",
  answer:
  "Lui è italiano. \n 彼はイタリア人です。" },

  { id: 40095, label: "Loro ( ) studentesse italiane.",
  question:
  "Loro ( ) studentesse italiane. \n essereの活用形",
  answer:
  "Loro sono studentesse italiane. \n 彼女たちはイタリア人の女子学生です。" },

  { id: 40096, label: "Io ( ) medico.",
  question:
  "Io ( ) medico. \n essereの活用形",
  answer:
  "Io sono medico. \n 私は医者です。" },

  { id: 40097, label: "Lei ( ) Maria.",
  question:
  "Lei ( ) Maria. \n essereの活用形",
  answer:
  "Lei è Maria. \n 彼女はマリーアです。" },

  { id: 40098, label: "Noi ( ) giapponesi.",
  question:
  "Noi ( ) giapponesi. \n essereの活用形",
  answer:
  "Noi siamo giapponesi. \n 私たちは日本人です。" },

  { id: 40099, label: "Voi ( ) brave.",
  question:
  "Voi ( ) brave. \n essereの活用形",
  answer:
  "Voi siete brave. \n あなたたちは優秀です。" },

  { id: 40100, label: "Lei ( ) il signor Dini?",
  question:
  "Lei ( ) il signor Dini? \n essereの活用形",
  answer:
  "Lei è il signor Dini? \n あなたはディーニさんですか？" },

  { id: 40101, label: "Io non ( ) tedesco.",
  question:
  "Io non ( ) tedesco. \n essereの活用形",
  answer:
  "Io non sono tedesco. \n 私はドイツ人ではありません。" },

  { id: 40102, label: "Lui ( ) bello.",
  question:
  "Lui ( ) bello. \n essereの活用形",
  answer:
  "Lui è bello. \n 彼はハンサムだ。" },

  { id: 40103, label: "Paola ( ) una ragazza alta.",
  question:
  "Paola ( ) una ragazza alta. \n essereの活用形",
  answer:
  "Paola è una ragazza alta. \n パオラは背の高い女の子だ。" },

  { id: 40104, label: "( ) Suzuki.",
  question:
  "( ) Suzuki.\n 私は鈴木です。 \n essereの活用形",
  answer:
  "Sono Suzuki." },

  { id: 40105, label: "( ) spagnoli.",
  question:
  "( ) spagnoli. \n 私たちはスペイン人です。 \n essereの活用形",
  answer:
  "Siamo spagnoli." },

  { id: 40106, label: "( ) la signora Albano.",
  question:
  "( ) la signora Albano. \n 彼女はアルバーノ夫人です。 \n essereの活用形",
  answer:
  "È la signora Albano." },

  { id: 40106, label: "Rosa, ( ) molto gentile.",
  question:
  "Rosa, ( ) molto gentile. \n ローザ、君はとても親切です。 \n essereの活用形",
  answer:
  "Rosa, sei molto gentile." },

  { id: 40107, label: "( ) libri giapponesi.",
  question:
  "( ) libri giapponesi. \n それらは日本の本です。 \n essereの活用形",
  answer:
  "Sono libri giapponesi." },

  { id: 40108, label: "( ) americana?. - Si, ( ) americana.",
  question:
  "( ) americana?. - Si, ( ) americana. \n あなたはアメリカ人ですか？ - はい、アメリカ人です。 \n essereの活用形",
  answer:
  "Sei americana?. - Si, sono americana." },

  { id: 40109, label: "Ragazze, ( ) francesi?. - No, ( ) inglesi.",
  question:
  "Ragazze, ( ) francesi?. - No, ( ) inglesi. \n 娘さん方、あなたたちはフランス人ですか？ - いいえ、イギリス人です。 \n essereの活用形",
  answer:
  "Ragazze, siete francesi?. - No, siamo inglesi." },

  { id: 40110, label: "( ) tre studenti.",
  question:
  "( ) tre studenti. \n 彼らは3人の男子学生です。 \n essereの活用形",
  answer:
  "Sono tre studenti." },

  { id: 40111, label: "私(男性)は日本人です。",
  question:
  "私(男性)は日本人です。",
  answer:
  "Sono giapponese." },

  { id: 40112, label: "私(女性)は日本人です。",
  question:
  "私(女性)は日本人です。",
  answer:
  "Sono giapponese." },

  { id: 40113, label: "君(男性)はイタリア人です。",
  question:
  "君(男性)はイタリア人です。",
  answer:
  "Sei italiano." },

  { id: 40114, label: "君(女性)はイタリア人です。",
  question:
  "君(女性)はイタリア人です。",
  answer:
  "Sei italiana." },

  { id: 40115, label: "彼はFrancoです。",
  question:
  "彼はFrancoです。",
  answer:
  "È Franco." },

  { id: 40116, label: "彼女は教師です。",
  question:
  "彼女は教師です。",
  answer:
  "È insegnante. \n essereを使って職業を言う場合、名詞の前に冠詞をつけない" },

  { id: 40117, label: "あなた(男性・敬称)は医師ですか？",
  question:
  "あなた(男性・敬称)は医師ですか？",
  answer:
  "È medico?" },

  { id: 40118, label: "私は弁護士です。",
  question:
  "私は弁護士です。",
  answer:
  "Sono avvocato." },

  { id: 40119, label: "彼は会社員です。",
  question:
  "彼は会社員です。",
  answer:
  "È impiegato." },

  { id: 40120, label: "彼らは日本人です。",
  question:
  "彼らは日本人です。",
  answer:
  "Sono giapponesi." },

  { id: 40121, label: "彼女たちはイタリア人です。",
  question:
  "彼女たちはイタリア人です。",
  answer:
  "Sono italiane." },

  { id: 40122, label: "君たち(男女混合)は頭が良い。",
  question:
  "君たち（男女混合）は頭が良い。",
  answer:
  "Siete intelligenti." },

  { id: 40123, label: "Marcoは背が高い。",
  question:
  "君マルコは背が高い。",
  answer:
  "Marco è alto." },

  { id: 40124, label: "Lauraは背が高くない。",
  question:
  "Lauraは背が高くない。",
  answer:
  "Laura non è alta." },

  { id: 40125, label: "Lucioは内気です。",
  question:
  "Lucioは内気です。",
  answer:
  "Lucio è timido." },

  { id: 40126, label: "Luciaはとてもきれいです。",
  question:
  "Luciaはとてもきれいです。",
  answer:
  "Lucia è molto bella."+
  "\n moltoは「たくさんの」という形容詞、「とても」という副詞の意味がある。副詞のときは語尾変化しない。" },

  { id: 40127, label: "AnnaとMariaは幸せです。",
  question:
  "AnnaとMariaは幸せです。",
  answer:
  "Anna e Maria sono felici." },

  { id: 40128, label: "僕とGianniは陽気です。",
  question:
  "僕とGianniは陽気です。",
  answer:
  "Io e Gianni siamo allegri." },

  { id: 40129, label: "君とPaolaはエレガントです。",
  question:
  "君とPaolaはエレガントです。",
  answer:
  "Tu e Paola siete eleganti." },

  { id: 40130, label: "私たち(男女混合)はスペインの学生です。",
  question:
  "私たち(男女混合)はスペインの学生です。",
  answer:
  "Siamo studenti spagnoli." },

  { id: 40131, label: "彼女はずる賢い女性だ。",
  question:
  "彼女はずる賢い女性だ。",
  answer:
  "È una donna furba." },

  { id: 40132, label: "彼女はずる賢い女性ではない。",
  question:
  "彼女はずる賢い女性ではない。",
  answer:
  "Non è una donna furba." },

  { id: 40133, label: "彼はとても忙しい弁護士です。",
  question:
  "彼はとても忙しい弁護士です。",
  answer:
  "È un avvocato molto occupato." },

  { id: 40134, label: "君は優秀な会社員だ。",
  question:
  "君は優秀な会社員だ。",
  answer:
  "Sei un bravo impiegato." },

  { id: 40135, label: "Giovanniは哀れな老人です。",
  question:
  "Giovanniは哀れな老人です。",
  answer:
  "Giovanni è un povero anziano." },

  { id: 40136, label: "彼は偉大な医者です。",
  question:
  "彼は偉大な医者です。",
  answer:
  "È un grande medico." },



// ===========================================
//           =======
//           =======
//           =======
//           =======
//           =======
//           =======
//           =======
//           =======
//           =======
//           =======
//           =======
//           =======
//           =======
//      =================
//       ===============
//        =============
//         ===========
//          =========
//           =======
//            =====
//             ===
//              =
// ===========================================





  { id: 45001, label: "croissant",
  question:
  "クロワッサンcroissant",
  answer:
  "cornetto" },

  { id: 45002, label: "Thank you.",
  question:
  "ありがとう Thank you.",
  answer:
  "Grazie." },

  { id: 45003, label: "milk",
  question:
  "牛乳 milk",
  answer:
  "latte" },

  { id: 45004, label: "tea",
  question:
  "茶 tea",
  answer:
  "tè" },

  { id: 45005, label: "Hello.",
  question:
  "こんにちは Hello",
  answer:
  "Salve." },

  { id: 45006, label: "Please.",
  question:
  "ください Please.",
  answer:
  "Per favore." },

  { id: 45007, label: "Goodbye.",
  question:
  "さようなら Goodbye.",
  answer:
  "Arrivederci.", },

  { id: 45008, label: "sugar",
  question:
  "砂糖 sugar",
  answer:
  "zucchero", },

  { id: 45009, label: "Philadelphia",
  question:
  "Philadelphia",
  answer:
  "Filadelfia", },

  { id: 45010, label: "Nice to meet you.",
  question:
  "Nice to meet you.",
  answer:
  "Piacere.", },

  { id: 45011, label: "Milan",
  question:
  "Milan",
  answer:
  "Milano", },

  { id: 45012, label: "Where are you from?",
  question:
  "Where are you from?",
  answer:
  "Di dove sei?", },

  { id: 45013, label: "I'm from Philadelphia.",
  question:
  "I'm from Philadelphia.",
  answer:
  "Io sono di Filadelfia.", },

  { id: 45014, label: "London",
  question:
  "London",
  answer:
  "Londra", },

  { id: 45015, label: "Rome",
  question:
  "Rome",
  answer:
  "Roma", },

  { id: 45016, label: "Hi.",
  question:
  "Hi.",
  answer:
  "Ciao.", },

  { id: 45017, label: "Excuse me.",
  question:
  "Excuse me.",
  answer:
  "Scusa.", },

  { id: 45018, label: "to invite",
  question:
  "to invite",
  answer:
  "invitare", },

  { id: 45019, label: "È un dolce facile e delizioso.",
  question:
  "È un dolce facile e delizioso.",
  answer:
  "It's an easy and delicious dessert.", },

  { id: 45020, label: "Io di solito prendo tre fragole e le metto nel gelato.",
  question:
  "Io di solito prendo tre fragole e le metto nel gelato.",
  answer:
  "I usually take three strawberries and put them in the ice cream.", },

  { id: 45021, label: "daughter",
  question:
  "daughter",
  answer:
  "figlia", },

  { id: 45022, label: "son",
  question:
  "son",
  answer:
  "figlio", },

  { id: 45023, label: "wife",
  question:
  "wife",
  answer:
  "moglie", },

  { id: 45024, label: "husband",
  question:
  "husband",
  answer:
  "marito", },

  { id: 45025, label: "father",
  question:
  "father",
  answer:
  "padre", },

  { id: 45026, label: "mother",
  question:
  "mother",
  answer:
  "madre", },

  { id: 45027, label: "restaurant",
  question:
  "restaurant",
  answer:
  "ristorante", },

  { id: 45028, label: "restroom,toilet",
  question:
  "restroom,toilet",
  answer:
  "bagno", },

  { id: 45029, label: "store",
  question:
  "store",
  answer:
  "negozio" },

  { id: 45030, label: "Thank you very much.",
  question:
  "Thank you very much.",
  answer:
  "Grazie mille." },

  { id: 45031, label: "pharmacy",
  question:
  "pharmacy",
  answer:
  "farmacia" },

  { id: 45032, label: "theater",
  question:
  "theater",
  answer:
  "teatro" },

  { id: 45033, label: "Where's the square? There is a square here.",
  question:
  "Where's the square? There is a square here.",
  answer:
  "Dov'è la piazza? C'è una piazza qui.", },

  { id: 45034, label: "church",
  question:
  "church",
  answer:
  "chiesa", },

  { id: 45035, label: "cafe",
  question:
  "cafe",
  answer:
  "bar", },

  { id: 45036, label: "ma'am",
  question:
  "ma'am",
  answer:
  "signora", },

  { id: 45037, label: "bank",
  question:
  "bank",
  answer:
  "banca", },






];

// クイズブロック作成
const titles = ["イタリア語"]; // 任意の科目名リスト
const template = document.querySelector('.quiz-block'); // 最初のブロックをテンプレートに
const container = document.createElement('div'); // 全体を包む要素（任意）

titles.forEach((title, index) => {
  const newBlock = template.cloneNode(true);
  newBlock.id = `quizBlock-${index}`;

  // タイトル書き換え
  newBlock.querySelector('p.title').textContent = title;

  // ID付き要素のIDをすべて更新
  const elementsWithId = newBlock.querySelectorAll('[id]');
  elementsWithId.forEach(el => {
    const oldId = el.id;
    const newId = oldId.replace(/-\d+$/, `-${index}`);
    el.id = newId;
  });

  container.appendChild(newBlock);
});

// 元のテンプレートは削除しておく（重複を防ぐ）
template.remove();
document.body.appendChild(container); // あるいは適切な場所へ追加



// クイズ作成
function createQuiz(blockId, data) {
    const questionArea = document.getElementById(`questionArea-${blockId}`);
    const answerArea = document.getElementById(`answerArea-${blockId}`);
    const nextBtn = document.getElementById(`nextBtn-${blockId}`);
    const showAnswerBtn = document.getElementById(`showAnswerBtn-${blockId}`);
    const correctBtn = document.getElementById(`correctBtn-${blockId}`);
    const wrongBtn = document.getElementById(`wrongBtn-${blockId}`);
    const statusTable = document.getElementById(`statusTable-${blockId}`);
    const startSelect = document.getElementById(`startSelect-${blockId}`);
    const endSelect = document.getElementById(`endSelect-${blockId}`);
    const excludeCorrectSelect = document.getElementById(`excludeCorrectSelect-${blockId}`);
    const sortSelect = document.getElementById(`sortSelect-${blockId}`);
    const resetCountsBtn = document.getElementById(`resetCountsBtn-${blockId}`);


    let currentId = null;
    let remaining = [];
    let previousHighlightedId = null; // 前回青くしたセルのIDを保存
    let lastBlueId = null; // 直前に青にしたセル



    const statusMap = new Map();
    const wrongCounts = new Map();
    const correctCounts = new Map();

    // 状態初期化
    function init() {
        startSelect.innerHTML = '';
        endSelect.innerHTML = '';
        excludeCorrectSelect.innerHTML = '';
        lastBlueId = null;

        data.forEach(d => {
            const opt1 = document.createElement("option");
            opt1.value = d.id;
            opt1.textContent = d.id;
            const opt2 = opt1.cloneNode(true);
            startSelect.appendChild(opt1);
            endSelect.appendChild(opt2);
        });
        startSelect.value = data[0].id;
        endSelect.value = data[data.length - 1].id;

        for (let i = 1; i <= 10; i++) {
            const opt = document.createElement("option");
            opt.value = i;
            opt.textContent = i;
            excludeCorrectSelect.appendChild(opt);
        }
        excludeCorrectSelect.value = 10;


        for (const [value, label] of [
        ['label-asc', 'label昇順'],
        ['label-desc', 'label降順'],
        ['id-asc', 'id昇順'],
        ['id-desc', 'id降順']
        ]) {
            const opt = document.createElement("option");
            opt.value = value;
            opt.textContent = label;
            sortSelect.appendChild(opt);
        }
        sortSelect.value = 'label-asc';

        startSelect.value = localStorage.getItem(`startSelect-${blockId}`) ?? data[0].id;
        endSelect.value = localStorage.getItem(`endSelect-${blockId}`) ?? data[data.length - 1].id;
        excludeCorrectSelect.value = localStorage.getItem(`excludeCorrectSelect-${blockId}`) ?? 5;
        sortSelect.value = localStorage.getItem(`sortSelect-${blockId}`) ?? 'label-asc';


        buildTable();
        loadWrongCounts();
        loadCorrectCounts();
        resetState();
        loadCellColors(); // ← 最後に追加
    }
  
    // テーブル作成
    function buildTable() {
        statusTable.innerHTML = '';
        statusMap.clear();
        const sortedData = getSortedData();
        const rowHeight = 500 / data.length + 'px';

        sortedData.forEach(d => {
            const row = statusTable.insertRow();
            const cell = row.insertCell();
            cell.textContent = d.label;
            row.style.height = rowHeight;
            cell.style.position = "relative";

            const wrongCount = wrongCounts.get(d.id) ?? 0;
            const correctCount = correctCounts.get(d.id) ?? 0;

            // weight計算 (不正解+1)/(正解+1)
            // const weight = ((wrongCount + 1) / (correctCount + 1)).toFixed(2);
            const now = new Date();
            const days = d.lastReview ? Math.floor((now - new Date(d.lastReview)) / (1000 * 60 * 60 * 24)) : 365;
            const base = (wrongCount + 1) / (correctCount + 1);
            const timeFactor = 1 - Math.exp(-days / (5 * (correctCount + 1)));
            const timeScale = 2.0;
            const jitter = 1 + (Math.random() - 0.5) * 0;
            const lowCorrectBoost = 0.12 * (1 / (correctCount + 1));
            const weight = (base * (1 + timeFactor * timeScale) * jitter * (1 + lowCorrectBoost)).toFixed(2);

            // weight表示
            const weightSpan = document.createElement("span");
            weightSpan.className = "weight-display";
            weightSpan.textContent = weight;
            cell.appendChild(weightSpan);

            const wrongSpan = document.createElement("span");
            wrongSpan.className = "wrong-count";
            wrongSpan.textContent = `×${wrongCount}`;
            cell.appendChild(wrongSpan);

            const correctSpan = document.createElement("span");
            correctSpan.className = "correct-count";
            correctSpan.textContent = `○${correctCount}`;
            cell.appendChild(correctSpan);

            statusMap.set(d.id, { cell, wrongSpan, correctSpan, weightSpan });

            // ← ここで lastBlueId と一致すれば blue を復元（青は保存しない一時状態なので上書き）
            if (lastBlueId !== null && lastBlueId === d.id) {
                cell.className = ''; // 保存されている色（green/red）があれば一旦消して青を優先
                cell.classList.add('blue');
            }
        });

        loadCellColors();

        
    }



    // 問題文・答えリセット
    function resetState() {
        remaining = [];
        currentId = null;
        lastBlueId = null;
        questionArea.textContent = "ここに問題文が表示されます";
        answerArea.textContent = "ここに答えが表示されます";
        data.forEach(d => {
            const entry = statusMap.get(d.id);
            entry.cell.className = '';
        });
        setButtonsEnabled(false);
        buildTable();
    }


    // 正解・不正解数をリセットボタンを押したとき
    resetCountsBtn.addEventListener('click', () => {
        if (!confirm('正解・不正解数をリセットしますか？')) return;

        // カウント初期化
        wrongCounts.clear();
        correctCounts.clear();

        // localStorageから削除
        localStorage.removeItem(`wrongCounts-${blockId}`);
        localStorage.removeItem(`correctCounts-${blockId}`);
        localStorage.removeItem(`cellColors-${blockId}`); // ← この1行を追加


        // テーブル再描画
        buildTable();
    });

    // ボタンを使えないようにする
    function setButtonsEnabled(enabled) {
        showAnswerBtn.disabled = !enabled;
        correctBtn.disabled = !enabled;
        wrongBtn.disabled = !enabled;
    }


    // 出題範囲の取得
    function getRangeData() {
        const start = parseInt(startSelect.value);
        const end = parseInt(endSelect.value);
        const excludeThreshold = parseInt(excludeCorrectSelect.value);
        return data.filter(d =>
            d.id >= start &&
            d.id <= end &&
            (correctCounts.get(d.id) ?? 0) < excludeThreshold
        );
    }
    // 並び順の取得
    function getSortedData() {
        const sortType = sortSelect.value;
        const sorted = [...data];
        switch (sortType) {
            case 'label-asc':
            sorted.sort((a, b) => a.label.localeCompare(b.label));
            break;
            case 'label-desc':
            sorted.sort((a, b) => b.label.localeCompare(a.label));
            break;
            case 'id-asc':
            sorted.sort((a, b) => a.id - b.id);
            break;
            case 'id-desc':
            sorted.sort((a, b) => b.id - a.id);
            break;
        }
        return sorted;
    }
 

    // 出題
    function pickQuestion() {
        if (remaining.length === 0) {
            questionArea.textContent = "おわり！";
            answerArea.textContent = "";
            setButtonsEnabled(false);
            return;
        }

        const now = new Date();
        const weights = remaining.map(item => {
            const wrong = wrongCounts.get(item.id) ?? 0;
            const correct = correctCounts.get(item.id) ?? 0;

            let days = 0;
            if (item.lastReview) {
                days = Math.floor((now - new Date(item.lastReview)) / (1000 * 60 * 60 * 24));
            }

            return ((wrong + 1) / (correct + 1)) * (1 + days * 0.1);
        });

        const totalWeight = weights.reduce((a, b) => a + b, 0);
        let r = Math.random() * totalWeight;
        let index = 0;
        for (let i = 0; i < weights.length; i++) {
            r -= weights[i];
            if (r <= 0) {
                index = i;
                break;
            }
        }

        const item = remaining.splice(index, 1)[0];
        currentId = item.id;
        item.lastReview = now; // 出題時に更新

        let styledQuestion = item.question
          .replace(/(\(|（)(.*?)(\)|）)/g, '<span style="color: orange;">$1$2$3</span>')
          .replace(/【(.*?)】|{(.*?)}/g, (match, p1, p2) => {
            if (p1 !== undefined) return `<span style="color: red; font-weight: bold;">【${p1}】</span>`;
            if (p2 !== undefined) {
              let inner = p2.replace(/【(.*?)】/g, '<span style="color: red; font-weight: bold;">【$1】</span>');
              return `<span style="color: blue; font-weight: bold; text-decoration: underline;">{${inner}}</span>`;
            }
            return match;
          });

        questionArea.innerHTML = styledQuestion;
        answerArea.innerHTML = `<span style="color: gray;">ここに答えが表示されます</span>`;
        highlightCell(item.id, 'blue');
        setButtonsEnabled(true);

        if (window.MathJax) MathJax.typesetPromise([questionArea]);
    }


    // セル色を付ける
    // function highlightCell(id, className) {
    //     const entry = statusMap.get(id);
    //     entry.cell.className = '';
    //     if (className) {
    //             entry.cell.classList.add(className);
    //             saveCellColor(id, className); // ← 追加
    //     } else {
    //             removeCellColor(id); // ← 追加：色を消したときにも反映
    //     }
    // }
    // function highlightCell(id, className) {
    //     // 前回青だったセルを元の色に戻す
    //     if (previousHighlightedId !== null && previousHighlightedId !== id) {
    //         restoreCellClass(previousHighlightedId); // 復元処理
    //     }

    //     const entry = statusMap.get(id);
    //     entry.cell.className = '';
    //     if (className) {
    //         entry.cell.classList.add(className);
    //         if (className !== 'blue') {
    //             saveCellColor(id, className);
    //         }
    //     } else {
    //         removeCellColor(id);
    //     }

    //     // 今回青くしたセルを記録
    //     if (className === 'blue') {
    //         previousHighlightedId = id;
    //     } else {
    //         previousHighlightedId = null;
    //     }
    // }
    function highlightCell(id, className) {
      // 新しい青を付ける直前に、前回の青セルを元の色に戻す
      if (className === 'blue' && lastBlueId !== null && lastBlueId !== id) {
        restoreCellClass(lastBlueId);
      }

      const entry = statusMap.get(id);
      if (!entry) return;

      // いったん全消ししてから指定色を適用
      entry.cell.className = '';
      if (className) {
        entry.cell.classList.add(className);

        if (className !== 'blue') {
          // green/red は保存（blue は保存しない）
          saveCellColor(id, className);
          lastBlueId = null; // 青の選択状態は解除
        } else {
          // blue は保存しないが、直前の青として記録
          lastBlueId = id;
        }
      } else {
        // 色を外すリクエスト
        removeCellColor(id);
        if (lastBlueId === id) lastBlueId = null;
      }
    }


    // function restoreCellClass(id) {
    //     const entry = statusMap.get(id);
    //     if (!entry) return;

    //     // localStorageに保存されているクラスを復元
    //     const savedClass = loadCellColor(id);
    //     entry.cell.className = '';

    //     if (savedClass) {
    //         entry.cell.classList.add(savedClass);
    //     }
    // }
    function restoreCellClass(id) {
      const entry = statusMap.get(id);
      if (!entry) return;

      entry.cell.className = '';
      const savedClass = getSavedCellColor(id); // ← 1件取得に変更
      if (savedClass) {
        entry.cell.classList.add(savedClass);
      }
    }

    // セル色を保存
    function saveCellColor(id, className) {
        if (className !== "blue"){
            const key = `cellColors-${blockId}`;
            const saved = localStorage.getItem(key);
            const colors = saved ? JSON.parse(saved) : {};
            colors[id] = className;
            localStorage.setItem(key, JSON.stringify(colors));
        }
    }
    // セル色を削除
    function removeCellColor(id) {
        const key = `cellColors-${blockId}`;
        const saved = localStorage.getItem(key);
        if (saved) {
            const colors = JSON.parse(saved);
            delete colors[id];
            localStorage.setItem(key, JSON.stringify(colors));
        }
    }
    // セル色をロード
    function loadCellColors() {
        const key = `cellColors-${blockId}`;
        const saved = localStorage.getItem(key);
        if (saved) {
            const colors = JSON.parse(saved);
            for (const [idStr, className] of Object.entries(colors)) {
            const id = parseInt(idStr);
            const entry = statusMap.get(id);
            if (entry) {
                entry.cell.classList.add(className);
            }
            }
        }
        // 追加：lastBlueId があれば青を優先して復元（青は保存されない一時表示）
        if (lastBlueId !== null) {
            const entry = statusMap.get(lastBlueId);
            if (entry) {
                entry.cell.className = '';
                entry.cell.classList.add('blue');
            }
        }
    }

    function getSavedCellColor(id) {
      const key = `cellColors-${blockId}`;
      const saved = localStorage.getItem(key);
      if (!saved) return null;
      const colors = JSON.parse(saved);
      return colors[id] ?? null;
    }


    // 間違い数を保存
    function saveWrongCounts() {
        const obj = {};
        for (const [id, count] of wrongCounts.entries()) {
            obj[id] = count;
        }
        localStorage.setItem(`wrongCounts-${blockId}`, JSON.stringify(obj));
    }
    // 間違い数をロード
    function loadWrongCounts() {
        const saved = localStorage.getItem(`wrongCounts-${blockId}`);
        if (saved) {
            const obj = JSON.parse(saved);
            for (const [idStr, count] of Object.entries(obj)) {
                const id = parseInt(idStr);
                wrongCounts.set(id, count);

                // カウントを表示
                const entry = statusMap.get(id);
                if (entry && entry.wrongSpan) {
                    entry.wrongSpan.textContent = `×${count}`;
                }
            }
        }
    }
  
    // 正解数を保存
    function saveCorrectCounts() {
        const obj = {};
        for (const [id, count] of correctCounts.entries()) {
            obj[id] = count;
        }
        localStorage.setItem(`correctCounts-${blockId}`, JSON.stringify(obj));
    }
    // 正解数をロード
    function loadCorrectCounts() {
        const saved = localStorage.getItem(`correctCounts-${blockId}`);
        if (saved) {
            const obj = JSON.parse(saved);
            for (const [idStr, count] of Object.entries(obj)) {
                const id = parseInt(idStr);
                correctCounts.set(id, count);

                // カウントを表示
                const entry = statusMap.get(id);
                if (entry && entry.correctSpan) {
                    entry.correctSpan.textContent = `○${count}`;
                }
            }
        }
    }

    // 出題範囲の値が変わったら保存
    startSelect.addEventListener('change', () => {
        localStorage.setItem(`startSelect-${blockId}`, startSelect.value);
    });
    endSelect.addEventListener('change', () => {
        localStorage.setItem(`endSelect-${blockId}`, endSelect.value);
    });
    // 正解数による出題範囲が変わったら保存
    excludeCorrectSelect.addEventListener('change', () => {
        localStorage.setItem(`excludeCorrectSelect-${blockId}`, excludeCorrectSelect.value);
    });


    // 正解数による出題範囲が変わったら保存
    sortSelect.addEventListener('change', () => {
        localStorage.setItem(`sortSelect-${blockId}`, sortSelect.value);
        buildTable();
    });
    // 出題ボタンを押したとき
    nextBtn.addEventListener('click', () => {
        const rangeData = getRangeData();
        // 出題する問題が無くなったらおわり！
        if (remaining.length === 0 && questionArea.textContent === "おわり！") {
            resetState();
        }
        remaining = rangeData.slice();
        pickQuestion();
    });

    function colorizeParentheses(text) {
      const colors = [
        "#FFA500", // 濃いオレンジ
        "#FFB733", // 少し薄い
        "#FFCC80", // さらに薄い
        "#FFE0B3"  // もっと薄い（必要なら増やす）
      ];

      let result = "";
      let depth = 0;

      for (let char of text) {
        if (char === "(" || char === "（") {
          const color = colors[Math.min(depth, colors.length - 1)];
          result += `<span style="color: ${color};">` + char;
          depth++;
        } else if (char === ")" || char === "）") {
          depth = Math.max(0, depth - 1);
          result += char + "</span>";
        } else {
          result += char;
        }
      }

      return result;
    }

    // 答えを見るボタンを押したとき
    showAnswerBtn.addEventListener('click', () => {
        if (currentId !== null) {
            const item = data.find(d => d.id === currentId);
            // answerArea.innerHTML = `<span style="color: black;">${item.answer}</span>`;

          let styledAnswer = colorizeParentheses(item.answer)
            // 【】と{}の処理を適用
            .replace(/【(.*?)】|{(.*?)}/g, (match, p1, p2) => {
              if (p1 !== undefined) {
                return `<span style="color: red; font-weight: bold;">【${p1}】</span>`;
              }
              if (p2 !== undefined) {
                let inner = p2.replace(/【(.*?)】/g, '<span style="color: red; font-weight: bold;">【$1】</span>');
                return `<span style="color: blue; font-weight: bold; text-decoration: underline;">{${inner}}</span>`;
              }
              return match;
            });

          // 全体黒で囲む
          answerArea.innerHTML = `<span style="color: black;">${styledAnswer}</span>`;
        }
        
        // MathJaxで数式を再描画
        if (window.MathJax) {
            MathJax.typesetPromise([answerArea]);
        }
    });
    // 正解したボタンを押したとき
    correctBtn.addEventListener('click', () => {
        if (currentId !== null) {
            const entry = statusMap.get(currentId);
            const newCount = (correctCounts.get(currentId) ?? 0) + 1;
            correctCounts.set(currentId, newCount);

            if (entry && entry.correctSpan) {
            entry.correctSpan.textContent = `○${newCount}`;
            }

            highlightCell(currentId, 'green');
            saveCorrectCounts();
            pickQuestion();
        }
    });
    // 不正解だったボタンを押したとき
    wrongBtn.addEventListener('click', () => {
        if (currentId !== null) {
            const entry = statusMap.get(currentId);
            const newCount = (wrongCounts.get(currentId) ?? 0) + 1;
            wrongCounts.set(currentId, newCount);

            if (entry && entry.wrongSpan) {
            entry.wrongSpan.textContent = `×${newCount}`;
            }

            highlightCell(currentId, 'red');
            saveWrongCounts();
            pickQuestion();
        }
    });

  // ▼ ソート用状態を追加
  let currentSortMode = 'default'; // 'id-asc', 'id-desc', 'weight-asc', 'weight-desc'

  // ▼ ID順ソートトグルボタンのイベント
  document.getElementById('toggleIdSortBtn').addEventListener('click', () => {
      if (currentSortMode === 'id-asc') {
          currentSortMode = 'id-desc';
      } else {
          currentSortMode = 'id-asc';
      }
      buildTable();
  });

  // ▼ Weight順ソートトグルボタンのイベント
  document.getElementById('toggleWeightSortBtn').addEventListener('click', () => {
      if (currentSortMode === 'weight-asc') {
          currentSortMode = 'weight-desc';
      } else {
          currentSortMode = 'weight-asc';
      }
      buildTable();
  });

  // ▼ getSortedData()を書き換え or 拡張
  function getSortedData() {
      const sorted = [...data];

      if (currentSortMode === 'id-asc') {
          sorted.sort((a, b) => a.id - b.id);
      } else if (currentSortMode === 'id-desc') {
          sorted.sort((a, b) => b.id - a.id);
      } else if (currentSortMode === 'weight-asc' || currentSortMode === 'weight-desc') {
          sorted.sort((a, b) => {
              const weightA = ((wrongCounts.get(a.id) ?? 0) + 1) / ((correctCounts.get(a.id) ?? 0) + 1);
              const weightB = ((wrongCounts.get(b.id) ?? 0) + 1) / ((correctCounts.get(b.id) ?? 0) + 1);
              return currentSortMode === 'weight-asc' ? weightA - weightB : weightB - weightA;
          });
      } else {
          // デフォルトは label-asc
          sorted.sort((a, b) => a.label.localeCompare(b.label));
      }

      return sorted;
  }







    init();
}

createQuiz(0, quizData0);
// createQuiz(1, quizData2);
// createQuiz(2, quizData3);
// createQuiz(3, quizData4);

// ---------------- LocalStorage表示トグル ----------------
const toggleBtn = document.getElementById('toggleStorageBtn');
const storageInfo = document.getElementById('storageInfo');
toggleBtn.addEventListener('click', () => {
  if (storageInfo.style.display === 'none' || storageInfo.style.display === '') {
    let output = '';
    for (let i = 0; i < localStorage.length; i++) {
      const key = localStorage.key(i);
      const value = localStorage.getItem(key);
      output += `${key} = ${value}\n`;
    }
    storageInfo.textContent = output;
    storageInfo.style.display = 'block';
  } else {
    storageInfo.style.display = 'none';
  }
});

// LocalStorageリセット
document.getElementById('clearStorageBtn').addEventListener('click', () => {
  if (confirm('LocalStorageをすべて消しますか？')) {
    localStorage.clear();
    storageInfo.textContent = '';
  }
});

// フローティングボタンのクリック
document.querySelectorAll('.floating-buttons button').forEach(button => {
  button.addEventListener('click', () => {
    const targetId = button.getAttribute('data-target');
    const targetElement = document.getElementById(targetId);
    if (targetElement) {
      targetElement.scrollIntoView({ behavior: 'smooth' });
    }
  });
});

// ---------------- ステータステーブル表示/非表示 ----------------
const toggleTableBtn = document.getElementById('toggleTableBtn');
const tableContainer = document.getElementById('statusTableContainer');
toggleTableBtn.addEventListener('click', () => {
  if (tableContainer.style.display === 'none' || tableContainer.style.display === '') {
    tableContainer.style.display = 'block';
  } else {
    tableContainer.style.display = 'none';
  }
});

</script>
</body>
</html>
